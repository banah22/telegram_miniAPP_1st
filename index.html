<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mini App</title>
    <style>
        body {
            display: flex;
            flex-direction: column; /* Располагаем элементы вертикально */
            align-items: flex-start; /* Выровнять элементы по левому краю */
            height: 100vh; /* Занять всю высоту окна */
            margin: 0;
            background-color: #f0f0f0;
            padding: 20px; /* Добавляем отступы для удобства */
            overflow: hidden; /* Скрыть прокрутку */
        }

        .user-info {
            display: flex;
            align-items: center; /* Центрируем аватар и имя по вертикали */
            margin-bottom: 20px; /* Отступ снизу */
        }

        .user-info img {
            width: 50px; 
            height: 50px;
            border-radius: 50%; 
            margin-right: 10px; 
        }

        .user-info span {
            font-weight: bold; 
        }

        button {
            position: absolute; /* Фиксируем кнопку внизу */
            bottom: 20px; /* Отступ снизу */
            left: 50%; /* Центрируем кнопку по горизонтали */
            transform: translateX(-50%); /* Смещаем кнопку на половину её ширины для центрирования */
            padding: 10px 40px;
            font-size: 16px;
            background-color: #4CAF50; /* Зеленый цвет по умолчанию */
            color: white;
            border: none;
            border-radius: 5px;
        }

        #timer {
            position: absolute; /* Позиционируем таймер по центру */
            top: 50%; /* Центрируем по вертикали */
            left: 50%; /* Центрируем по горизонтали */
            transform: translate(-50%, -50%); /* Смещаем на половину ширины и высоты для точного центрирования */
        }

        svg {
            width: 150px; /* Ширина круга */
            height: 150px; /* Высота круга */
        }

        circle {
            fill: none;
            stroke-width: 10;
            transform: rotate(-90deg);
            transform-origin: centre;
            
        }

        .background {
            stroke: #e6e6e6; /* Цвет фона круга */
            
        }

        .progress {
            stroke: #4CAF50; /* Цвет заполнения */
            transition: stroke-dashoffset 1s linear; /* Плавный переход */
            
            
        }

        .progress-dot {
            fill: #4CAF50; /* Цвет кружочка в начале прогресс-бара */
        }
    </style>
</head>
<body>

    <div class="user-info">
        <img id="userAvatar" src="placeholder.jpg" alt="User Avatar">
        <span id="userName">User Name</span>
    </div>

    <div id="output"></div> 

    <div id="timer">
        <svg viewBox="0 0 100 100">
            <circle class="background" cx="50" cy="50" r="45"></circle>
            <circle class="progress" cx="50" cy="50" r="45"></circle>
            
            <!-- Кружочек в начале прогресс-бара -->
            <circle class="progress-dot" cx="50" cy="5" r="5" /> <!-- Увеличен радиус кружочка -->
            
            <!-- Вставка изображения в круг -->
            <image href="banah.png" x="25" y="25" height="55" width="55" />
        </svg>
    </div>

    <button id="timerButton" onclick="toggleTimer()">Start</button>

    <script>
        let timerInterval = null; // Переменная для хранения интервала таймера
        let seconds = 0; // Переменная для отслеживания времени
        const totalTime = 180; // Общее время в секундах (можно изменить по желанию)
        
        const progressCircle = document.querySelector('.progress');

        // Устанавливаем начальное состояние круга
        const circumference = 2 * Math.PI * 45; // Длина окружности
        progressCircle.style.strokeDasharray = `${circumference}`; // Устанавливаем длину окружности
        progressCircle.style.strokeDashoffset = `${circumference}`; // Начальное значение (полностью невидимо)

        document.addEventListener('DOMContentLoaded', () => {
         // Инициализация Telegram Web App
         Telegram.WebApp.ready();
         // Разворачиваем приложение на весь экран
         Telegram.WebApp.expand();

         const outputDiv = document.getElementById('output');
         const initData = Telegram.WebApp.initData;

         const params = new URLSearchParams(initData);
         const userData = Object.fromEntries(params);

         if (userData.user) {
           const user = JSON.parse(userData.user); 
           
             outputDiv.textContent += `Username: ${user.username || "Имя пользователя не указано"}\n`;

           document.getElementById('userName').textContent = user.first_name || "Имя не указано";
           if (user.photo_url) {
             document.getElementById('userAvatar').src = user.photo_url;
           }
         } else {
           outputDiv.textContent += "User data not available.";
           document.getElementById('userName').textContent = "User data not available.";
         }
       });

       function toggleTimer() {
         const timerButton = document.getElementById('timerButton');
         
         if (timerInterval) {
           clearInterval(timerInterval); // Остановить таймер
           timerInterval = null;
           timerButton.textContent = "Start"; // Изменяем текст кнопки на "Start"
           timerButton.style.backgroundColor = "#4CAF50"; // Возвращаем зеленый цвет
           resetTimer(); // Сбросить таймер
         } else {
           startTimer();
           timerButton.textContent = "Stop"; // Изменяем текст кнопки на "Stop"
           timerButton.style.backgroundColor = "red"; // Меняем цвет кнопки на красный
         }
       }

       function startTimer() {
         seconds = 0; // Сбросить счетчик секунд


         timerInterval = setInterval(() => {
           seconds++; // Увеличиваем счетчик секунд
           
           const offset = (1 - (seconds / totalTime)) * circumference; // Вычисляем смещение для прогрессии
           progressCircle.style.strokeDashoffset = offset; // Обновляем смещение

           // Обновляем позицию кружочка
           const angle = (seconds / totalTime) * (2 * Math.PI); // Вычисляем угол в радианах
           const dotX = 5 + Math.cos(angle) * (45); // Вычисляем координату X кружочка
           const dotY = 50 + Math.sin(angle) * (45); // Вычисляем координату Y кружочка

           document.querySelector('.progress-dot').setAttribute('cx', dotX);
           document.querySelector('.progress-dot').setAttribute('cy', dotY);

           if (seconds >= totalTime) {
             clearInterval(timerInterval); // Остановить таймер по истечении времени
             timerInterval = null;
             document.getElementById('timerButton').textContent = "Start"; // Изменяем текст кнопки на "Start"
             document.getElementById('timerButton').style.backgroundColor = "#4CAF50"; // Возвращаем зеленый цвет
             resetTimer(); // Сбросить прогресс
           }
           
         }, 1000); // Обновляем каждую секунду
       }

       function resetTimer() {
         seconds = 0; 
         progressCircle.style.strokeDashoffset = `${circumference}`; // Сбросить прогресс обратно к началу

         // Сбросить позицию кружочка обратно к началу
         document.querySelector('.progress-dot').setAttribute('cx', '50');
         document.querySelector('.progress-dot').setAttribute('cy', '5'); 
       }
    </script>

</body>
</html>
