<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mini App</title>
    <style>
        body {
            display: flex;
            flex-direction: column; /* Располагаем элементы вертикально */
            align-items: flex-start; /* Выровнять элементы по левому краю */
            height: 100vh; /* Занять всю высоту окна */
            margin: 0;
            background-color: #ebffe0;
            padding: 20px; /* Добавляем отступы для удобства */
            overflow: hidden; /* Скрыть прокрутку */
        }

        .user-info {
            display: flex;
            align-items: center; /* Центрируем аватар и имя по вертикали */
            margin-bottom: 20px; /* Отступ снизу */
        }

        .user-info img {
            width: 50px; 
            height: 50px;
            border-radius: 50%; 
            margin-right: 10px; 
        }

        .user-info span {
            font-weight: bold; 
        }

        
        #timer {
            position: absolute; /* Позиционируем таймер по центру */
            top: 50%; /* Центрируем по вертикали */
            left: 50%; /* Центрируем по горизонтали */
            transform: translate(-50%, -50%); /* Смещаем на половину ширины и высоты для точного центрирования */
        }

        svg {
            width: 150px; /* Ширина круга */
            height: 150px; /* Высота круга */

        
            
        }

        circle {
            fill: #ccd1cb;
            stroke-width: 5;
            transform: rotate(-90deg);
            transform-origin: center;
            
        }

        .background {
            stroke: #bbb0ac; /* Цвет фона круга */
            
        }

        .progress {
            stroke: #4CAF50; /* Цвет заполнения */
            transition: stroke-dashoffset 1s linear; /* Плавный переход */
            
            
        }

        .progress-dot {
            fill: #4CAF50; /* Цвет кружочка в начале прогресс-бара */
        }

        button {
            position: absolute; /* Фиксируем кнопку внизу */
            bottom: 20px; /* Отступ снизу */
            left: 50%; /* Центрируем кнопку по горизонтали */
            transform: translateX(-50%); /* Смещаем кнопку на половину её ширины для центрирования */
            padding: 10px 40px;
            font-size: 16px;
            background-color: #4CAF50; /* Зеленый цвет по умолчанию */
            color: white;
            border: none;
            border-radius: 5px;
        }
        
        /* Стили для модального окна */
        .modal {
            display: none; /* Скрыто по умолчанию */
            position: fixed; /* Оверлей на весь экран */
            z-index: 1; /* На переднем плане */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Прокрутка, если нужно */
            background-color: rgb(0,0,0); /* Полупрозрачный фон */
            background-color: rgba(0,0,0,0.4); /* Полупрозрачный фон */
        }

        .modal-content {
            background-color: #f9fce6;
            margin: 15% auto; /* Центрирование */
            padding: 10px;
            border: 1px solid #f0f7cd;
            width: 80%; /* Ширина модального окна */
            min-height: 200px; /* Установите минимальную высоту модального окна, чтобы кнопки не располагались слишком близко к верху */
        }
        h2 { 
          text-align: center; 
          /** Центрирование заголовка **/ 
          color:#050505; /** Цвет заголовка **/ 
          font-weight:bold; /** Жирное начертание **/ 
          /** Дополнительные стили для заголовка **/ 
          margin-bottom :10px ; /** Отступ снизу **/ 
          font-size :24px ; /** Размер шрифта **/
         } 
        .vote-button { 
           padding :10px ; /** Отступы внутри кнопок **/ 
           border :none ; /** Убираем рамку **/ 
           border-radius :5px ; /** Закругление углов **/ 
           color :white ; /** Цвет текста **/ 
           font-size :16px ; /** Размер шрифта **/ 
           cursor :pointer ; /** Курсор при наведении **/ 
           margin :5px ; /** Отступ между кнопками **/ 
         } 

         .option1 { background-color :#4CAF50 ; } /** Зеленая кнопка **/ 
         .option2 { background-color :#FFC107 ; } /** Желтая кнопка **/ 
         .option3 { background-color :#F44336 ; } /** Красная кнопка **/ 
        
         
        
    </style>
    
</head>
<body>

    <div class="user-info">
        <img id="userAvatar" alt="User Avatar">
        <span id="userName">User Name</span>
    </div>

    <div id="output"></div> 

    <!-- Звуковой файл -->
    <audio id="timerSound" src="lz.mp3"></audio>

  <!-- Модальное окно -->
    <div id="voteModal" class="modal">
      <div class="modal-content">
          <h2>Голосование</h2> <!-- Заголовок будет центрирован -->
         
          <form id="voteForm">
              
                  <button type="button" class="vote-button option1" onclick="submitVote('option1')">Hardwork</button> <!-- Зеленая кнопка -->
                  <button type="button" class="vote-button option2" onclick="submitVote('option2')">Various</button> <!-- Желтая кнопка -->
                  <button type="button" class="vote-button option3" onclick="submitVote('option3')">LazyZopa</button> <!-- Красная кнопка -->
             
          </form>
      </div>
    </div>

    
    <div id="timer">
        <svg viewBox="0 0 100 100">
        <!-- Определяем область обрезки -->
                <defs>
                    <clipPath id="circleClip">
                        <circle cx="50" cy="50" r="40" /> <!-- Круг для обрезки -->
                    </clipPath>
                </defs>
            <circle class="background" cx="50" cy="50" r="45"></circle>
            <circle class="progress" cx="50" cy="50" r="45"></circle>
            
            <!-- Кружочек в начале прогресс-бара -->
            <circle class="progress-dot" cx="95" cy="50" r="5" /> <!-- Увеличен радиус кружочка -->
            
            <!-- Вставка изображения в круг -->
            <image href="ggirl.png" x="10" y="10" height="90" width="90" clip-path="url(#circleClip)" />
        </svg>
    </div>

    <button id="timerButton" onclick="toggleTimer()">Start</button>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script>
        let timerInterval = null; // Переменная для хранения интервала таймера
        let seconds = 0; // Переменная для отслеживания времени
        const totalTime = 60; // Общее время в секундах (можно изменить по желанию)
        
        const progressCircle = document.querySelector('.progress');
        const sound = document.getElementById('timerSound'); // Получаем элемент аудио
        const voteModal = document.getElementById('voteModal'); // Модальное окно
        
        // Устанавливаем начальное состояние круга
        const circumference = 2 * Math.PI * 45; // Длина окружности
        progressCircle.style.strokeDasharray = `${circumference}`; // Устанавливаем длину окружности
        progressCircle.style.strokeDashoffset = `${circumference}`; // Начальное значение (полностью невидимо)

        document.addEventListener('DOMContentLoaded', () => {
         // Инициализация Telegram Web App
         Telegram.WebApp.ready();
         // Разворачиваем приложение на весь экран
         Telegram.WebApp.expand();

         const outputDiv = document.getElementById('output');
         const initData = Telegram.WebApp.initData;

         const params = new URLSearchParams(initData);
         const userData = Object.fromEntries(params);

         if (userData.user) {
           const user = JSON.parse(userData.user); 
           
           //  outputDiv.textContent += `Username: ${user.username || "Имя пользователя не указано"}\n`;
          //   console.log(userData); // Выводим данные пользователя в консоль для отладки

           document.getElementById('userName').textContent = user.first_name || "Имя не указано";
           if (user.photo_url) {
             document.getElementById('userAvatar').src = user.photo_url;
           }
         } else {
           outputDiv.textContent += "User data not available.";
           document.getElementById('userName').textContent = "User data not available.";
            document.getElementById('userAvatar').src = 'banah.png'; 
         }
       });

       function toggleTimer() {
             const timerButton = document.getElementById('timerButton');
             
             if (timerInterval) {
                 clearInterval(timerInterval); // Остановить таймер
                 timerInterval = null;
                 timerButton.textContent = "Start"; // Изменяем текст кнопки на "Start"
                 resetTimer(); // Сбросить таймер
                 voteModal.style.display = "none"; // Скрыть модальное окно при остановке
             } else {
                 startTimer();
                 timerButton.textContent = "Stop"; // Изменяем текст кнопки на "Stop"
                 timerButton.style.backgroundColor = "red"; // Меняем цвет кнопки на красный
             }
         }


       function startTimer() {
         seconds = 0; // Сбросить счетчик секунд


         timerInterval = setInterval(() => {
           seconds++; // Увеличиваем счетчик секунд
           
           const offset = (1 - (seconds / totalTime)) * circumference; // Вычисляем смещение для прогрессии
           progressCircle.style.strokeDashoffset = offset; // Обновляем смещение

           // Обновляем позицию кружочка
           const angle = (seconds / totalTime) * (2 * Math.PI); // Вычисляем угол в радианах
           const dotX = 50 + Math.cos(angle) * (45); // Вычисляем координату X кружочка
           const dotY = 50 + Math.sin(angle) * (45); // Вычисляем координату Y кружочка

           document.querySelector('.progress-dot').setAttribute('cx', dotX);
           document.querySelector('.progress-dot').setAttribute('cy', dotY);

           if (seconds >= totalTime) {
             clearInterval(timerInterval); // Остановить таймер по истечении времени
           
             timerInterval = null;
             document.getElementById('timerButton').textContent = "Start"; // Изменяем текст кнопки на "Start"
             document.getElementById('timerButton').style.backgroundColor = "#4CAF50"; // Возвращаем зеленый цвет
             sound.play(); // Воспроизводим звук
             voteModal.style.display = "block"; // **Показать модальное окно с голосованием**
             resetTimer(); // Сбросить прогресс
           }
           
         }, 1000); // Обновляем каждую секунду
       }

       function resetTimer() {
         seconds = 0; 
         progressCircle.style.strokeDashoffset = `${circumference}`; // Сбросить прогресс обратно к началу

         // Сбросить позицию кружочка обратно к началу
         document.querySelector('.progress-dot').setAttribute('cx', '95');
         document.querySelector('.progress-dot').setAttribute('cy', '50'); 
       }

        function submitVote(option) { // Изменено на функцию с параметром выбора
             alert(`Вы выбрали ${option}`); // Здесь можно обработать результат голосования
             voteModal.style.display = "none"; // Скрыть модальное окно после голосования
         }
         
      
      window.onclick = function(event) {
          if (event.target == voteModal) {
              voteModal.style.display = "none"; // Закрыть модальное окно при клике вне его области
          }
      }
    </script>

</body>
</html>
